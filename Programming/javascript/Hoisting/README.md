# 호이스팅

> JavaScript에서 **호이스팅**(hoisting)이란, 인터프리터가 변수와 함수의 메모리 공간을 선언 전에 미리 할당하는 것을 의미합니다. 
>
>  `var`로 선언한 변수의 경우 호이스팅 시 `undefined`로 변수를 초기화합니다. 반면 `let`과 `const`로 선언한 변수의 경우 호이스팅 시 변수를 초기화하지 않습니다.
>
> 
>
> 출처: MDN



javascript 엔진은 변수 선언을 포함한 모든 선언문(변수 선언문, 함수 선언문 등)을 소스 코드에서 찾아내 먼저 실행

- 따라서 자바스크립트는 선언이 소스코드의 어디에 있든 상관없이 다른 코드보다 먼저 실행된다.

```js
catName("클로이");

function catName(name) {
  console.log("제 고양이의 이름은 " + name + "입니다");
}

/*
결과: "제 고양이의 이름은 클로이입니다"
*/
```

이처럼 선언문이 코드의 선두로 끌어 올려진 것처럼 동작하는 자바스크립트 고유의 특징을 **호이스팅**이라고 한다.

- 변수 선언 뿐만 아니라 **var, let, const, function, class 키워드를 사용해서 선언하는 모든 식별자(변수, 함수, 클래스 등)은 호이스팅**된다.
- 모든 선언문이 **런타임 이전 단계**에서 먼저 실행되기 때문

**주의)** 기본적으로 자바스크립트는 `초기화`를 제외한 `선언`만 호이스팅. 또한 초기화는 선언을 병행

```js
console.log(x) // ReferenceError 발생

x = 1 // x 초기화. 호이스팅이 발생하지는 않지만 x라는 변수 선언 후 1이라는 값으로 초기화

console.log(y) // undefined
var y; // y 선언, 호이스팅 발생, var 키워드 변수이므로 선언과 동시에 undefined로 초기화
y = 2; // y 초기화

console.log(x + y) // 3 
```



## 변수 선언 2단계

1. 선언 단계: 변수 이름을 등록해서 자바스크립트 엔진에 변수의 존재를 알린다.
2. 초기화 단계: 값을 저장하기 위한 메모리 공간을 확보하고, 할당된 값이 없으면 암묵적으로 `undefined`를 할당해 초기화한다.

> **초기화를 하는 이유**
>
>
> 일반적으로 초기화(initialization)란 변수가 선언된 이후 최초로 값을 할당하는 것을 말한다. 변수를 선언하여 확보된 메모리 공간에는 예전에 사용한 다른 값(쓰레기 값, garbage value)이 남아있을 수 있다.  따라서 초기화를 하지 않고 바로 값을 참조하면 쓰레기 값이 나올 수 있다. 

선언하지 않은 식별자에 접근하려고 하면 **ReferenceError(참조 에러)** 가 발생한다.

- 런타임 시점에서 현재 스코프에 자바스크립트 엔진이 식별자를 찾을 수 없거나, 선언으로 등록된 식별자가 참조하는 메모리 주소에 초기화(메모리 확보 후 값 할당)가 진행되어 있지 않은 경우 발생
- **식별자를 통해 값을 참조하려 했으나, 식별자를 찾을 수 없거나 값이 초기화되어 있지 않은 상태**



## var,  let, const 호이스팅

기본적으로 호이스팅 자체는 var, let, const 로 선언한 변수 모두 발생한다.

**var**

- 함수 레벨 스코프

- 변수 선언 시, **undefined**로 초기화가 함께 진행된다.

**let, const**

- 블록 레벨 스코프

- 변수 선언 시, 호이스팅이 발생하지만 초기화는 진행되지 않는다.
- 초기화 이전에 변수에 접근하려고 하면 **ReferenceError**가 발생한다.
  - let, const 키워드 변수의 경우에는 스코프의 시작 지점부터 초기화 지점까지 변수를 참조할 수 없는 구간이 생기는데, 이를 **일시적 사각지대(TDZ)**라고 한다.
    - **변수 선언 -> TDZ(Temporal Dead Zone) -> 초기화**
    - 코드가 실행되면서 let, const 변수 선언 과 값 할당이 나오기 전까지 변수는 TDZ에서 관리되고, 해당 코드가 나오기 전에 변수를 사용하려고 할 경우, TDZ에서 ReferenceError 예외를 발생시킨다. 
    - 스코프에 진입할 때부터 let,const 변수는 호이스팅되어 변수가 생성되고 TDZ의 제약을 받으나, 코드 실행 후 let,const 선언 및 할당된 시점부터 TDZ에서 벗어나 변수를 사용할 수 있게 된다.
  - **초기화 이전까지 변수를 참조할 수 없기 때문에 마치 호이스팅이 발생하지 않고 초기화만 진행되는 것처럼 보인다.**

```js
console.log(x); // ReferenceError

// ...

// TDZ

// ...

let x; // 스코프 진입할 때부터 호이스팅 발생, 변수 선언하여 변수 이름 등록 -> 이후 코드 실행 시 let x 선언문을 만나면 undefined로 값 초기화. 이전까지는 참조할 수 없음

console.log(x); // undefined
```





# 참고 

https://developer.mozilla.org/ko/docs/Glossary/Hoisting

https://medium.com/korbit-engineering/let%EA%B3%BC-const%EB%8A%94-%ED%98%B8%EC%9D%B4%EC%8A%A4%ED%8C%85-%EB%90%A0%EA%B9%8C-72fcf2fac365

모던 자바스크립트 Deep Dive